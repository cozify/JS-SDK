<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#000000">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script type="text/javascript" src="../dist/sdk-browser.js"></script>
    <script type="text/javascript">


      // Fill them as should
      //let fixedUsername = ""
      //let fixedPassword = ""
      let fixedUsername = 'vesa@cozify.fi'
      let fixedPassword = 'Fortum!123'
      let fixedHubId = 'cd3bd9e4-7943-11e5-a567-544a168673f2'
      let fixedDeviceId = '53d59fdc-bd8d-4231-a4a0-d6c6ee51d30e' // Power socet

      let store = CozifySDK.store;

      let LANGUAGES = CozifySDK.LANGUAGES;
      let events = CozifySDK.events;
      let EVENTS = CozifySDK.EVENTS;
      let USER_STATES = CozifySDK.USER_STATES;


      console.info(`Initial user state ${CozifySDK.getUserState()}`);
      console.info(`--1--`);

      CozifySDK.changeLanguage(LANGUAGES.FI_FI);
      console.info(`--2--`);


      CozifySDK.doPwLogin( fixedUsername, fixedPassword )
        .then((response) => {
          CozifySDK.acceptEula();
          console.info(`--3--`);

          //CozifySDK.doLogout();
          //console.info(`--4--`);


        })
        .catch(function (error) {
          console.info(`Pw failure when user state ${CozifySDK.getCloudConnectionState()}`, error);
        })


      let selected = false;
      let deviceStateChanged = false;
      store.subscribe(() => {
        const storeNow = store.getState()


        if (!selected && storeNow.hubs && storeNow.hubs[fixedHubId] && !storeNow.hubs[fixedHubId].selected)Â {
          selected = true;
          CozifySDK.selectHubById(fixedHubId);
        }

        console.info("Cloud connection:", CozifySDK.getCloudConnectionState());
        console.info("Hub connection:", CozifySDK.getHubConnectionState(fixedHubId));
        console.info("Hubs", storeNow.hubs)
        console.info("Devices:", CozifySDK.getDevices()[fixedHubId])

        if (storeNow.hubs && storeNow.hubs[fixedHubId] && storeNow.hubs[fixedHubId].selected) {
          const hubDevices = CozifySDK.getHubDevices(fixedHubId);
          if (hubDevices){
            let state = hubDevices[fixedDeviceId].state;
            if (!deviceStateChanged) {
              deviceStateChanged = true;
              state.isOn = !state.isOn;
              CozifySDK.sendDeviceCmd(fixedHubId, fixedDeviceId, state);
            }
          }

          /*
          setTimeout(function() {
            CozifySDK.unSelectHubById(fixedHubId);
          }, 10000);
          */

        }

      })

      /**
       * Listener of User state changes
      const unbindUserStateChangedListener = events.on(EVENTS.USER_STATE_CHANGED, newState => {
        console.log("USER_STATE CHANGED: ", newState);
        if (newState === USER_STATES.AUTHENTICATED){

        }
      });
       */


      /**
       * Listener of HUB list changes
      const unbindHubListCahngeListener = events.on(EVENTS.HUBS_LIST_CHANGED, eventHubs => {
        const hubs = CozifySDK.getHubs(); // Optional because eventHubs contains same info
        for (let key in hubs) {
          console.log(` Hub name: ${hubs[key].name} - role: ${hubs[key].roleString}`);
        }
      });
       */
    </script>
    <title>cozify-sdk</title>
  </head>

  <body>
    <p>
      Testing Cozify SDK in browser
    </p>
    <noscript>
      You need to enable JavaScript to run this app.
    </noscript>

  </body>
</html>
